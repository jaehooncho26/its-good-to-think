<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question 1 Page</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Istok+Web&display=swap" rel="stylesheet">
    <!-- Include Supabase JavaScript client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <header class="header">
        <!-- Left-aligned logo image -->
        <img src="think-logo.png" alt="think logo" class="logo-image">
        
        <!-- Centered title text -->
        <img src="its-good-to-think-text.png" alt="it's good to think" class="title-name-image">
        
        <!-- Right-aligned login button image -->
        <div class="login-button-container">
             <img src="login-button.png" alt="login button" id="login-button" class="login-button-image">
        </div>
    </header>
    
    <div class="summary-section-container">
        <img src="questions-text.png" alt="Summary Section" class="summary-section">
    </div>

    <div class="answer-section">
        <h2>who are you?</h2>
        <!-- Use a textarea to display the answer in the same box style as the original input -->
        <textarea id="q1Display" readonly></textarea>
    </div>

    <!-- Link to the external script.js file (if needed) -->
    <script src="script.js"></script>

    <script>
        // Initialize Supabase client with your project URL and anon key
        const supabaseClient = supabase.createClient('https://aqpyxfjhlypevabhrdxs.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxcHl4ZmpobHlwZXZhYmhyZHhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0MjgyODIsImV4cCI6MjA1ODAwNDI4Mn0.dXeKewJjtQG6EeQ7y-g7KwKjoK7i1dKrXmb6LnDzm5E');

        // Fetch and display q1 data when the page loads
        window.onload = async function() {
            const answerDisplayElement = document.getElementById("q1Display");

            try {
                // Get the current authenticated user
                const { data: { user }, error: userError } = await supabaseClient.auth.getUser();
				
                if (userError) throw userError;

                if (user) {
                    // Query the 'user_answers' table for the user's 'q1' value
                    const { data, error } = await supabaseClient
                        .from('user_answers')
                        .select('q1')
                        .eq('user_id', user.id)  // Use the authenticated user's ID
                        .single();               // Expect exactly one row

                    if (error) throw error;

                    // Display the fetched q1 value, or '...' if null
                    answerDisplayElement.value = data.q1 || '...';
                } else {
                    // User not logged in
                    answerDisplayElement.value = 'Please log in to see your answer';
                }
            } catch (error) {
                // Handle specific error for no row found
                if (error.message.includes('JSON object requested, multiple (or no) rows returned')) {
                    answerDisplayElement.value = 'No answer found';
                } else {
                    console.error('Error fetching data:', error);
                    answerDisplayElement.value = 'Error fetching data';
                }
            }
        };
    </script>
</body>
</html>